---
import { posters } from "../../lib/posters.js";

export function getStaticPaths() {
  return posters.map((p, idx) => {
    const prev = posters[idx - 1] ?? null;
    const next = posters[idx + 1] ?? null;

    return {
      params: { no: p.no3 },     // /odop/001
      props: { p, prev, next },  // 페이지에서 사용할 데이터
    };
  });
}

const { p, prev, next } = Astro.props;
---

<main class="detail">
  <header class="top">
    <a class="back" href="/">← Back</a>

    <div class="meta">
      <div class="no">{p.title}</div>
      <time class="date" datetime={p.date}>{p.date}</time>
    </div>

    <nav class="nav">
      {prev ? <a class="btn" href={`/odop/${prev.no3}`}>Prev</a> : <span class="btn disabled">Prev</span>}
      {next ? <a class="btn" href={`/odop/${next.no3}`}>Next</a> : <span class="btn disabled">Next</span>}
    </nav>
  </header>

<section class="viewer" data-mode="scroll" data-viewer>
  <div class="stage">
    <img class="poster" src={p.img} alt={p.title} data-poster />
  </div>
</section>


</main>

<style>
  :global(body) {
    margin: 0;
    background: #090909;
    color: #f9f9f9;
  }

  .detail {
    max-width: 1000px;
    margin: 0 auto;
    padding: 24px;
  }

  .top {
    display: grid;
    gap: 14px;
    margin-bottom: 18px;
  }

  .back {
    color: rgba(249, 249, 249, 0.7);
    text-decoration: none;
  }

  .no {
    font-weight: 700;
    font-size: 18px;
  }

  .date {
    color: rgba(249, 249, 249, 0.6);
    font-size: 12px;
  }

  .nav {
    display: flex;
    gap: 8px;
  }

  .btn {
    border: 1px solid rgba(249, 249, 249, 0.22);
    font-size: var(--ui-font-size);
    padding: 8px 10px;
    border-radius: 0;
    background: transparent;
    color: #f9f9f9;
    text-decoration: none;
    display: inline-block;
  }

  .disabled {
    opacity: 0.35;
    pointer-events: none;
  }

  .viewer {
    border: 1px solid rgba(249, 249, 249, 0.12);
  }
/* viewer가 “이미지 표시 영역”이고, JS가 --avail 값을 넣어줌 */
.viewer {
  --avail: 80vh; /* JS 계산 실패 시 안전값 */
}

/* stage: 실제 이미지가 들어가는 프레임 */
.stage {
  border: 1px solid rgba(249, 249, 249, 0.12);
  background: #090909;
}

/* 기본: Scroll 모드 (가로 100% / 세로는 스크롤) */
.viewer[data-mode="scroll"] .stage {
  height: var(--avail);
  overflow: auto;
}

.viewer[data-mode="scroll"] .poster {
  width: 100%;
  height: auto;
  display: block;
}

/* 클릭 토글: Fit 모드 (세로를 화면에 딱 맞추고 전체가 보이게) */
.viewer[data-mode="fit"] .stage {
  height: var(--avail);
  display: grid;
  place-items: center;
  overflow: hidden;
}

.viewer[data-mode="fit"] .poster {
  max-height: 100%;
  max-width: 100%;
  width: auto;
  height: auto;
  display: block;
}

  .poster {
    width: 100%;
    height: auto;
    display: block;
  }
</style>